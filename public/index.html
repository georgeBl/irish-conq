<!DOCTYPE html>
<meta charset="utf-8">

<head>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://npmcdn.com/tether@1.2.4/dist/js/tether.min.js"></script>
    <script src="https://npmcdn.com/bootstrap@4.0.0-alpha.5/dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-selection.v1.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/dist/domjson.min.js"></script>
</head>

<body>
    <h2>Click on a path to load a question</h2>




    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">
                        <script>


                        </script>
                    </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
                </div>
                <div class="modal-body" id="question">

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal" id="1Answer"></button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal" id="2Answer"></button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal" id="3Answer"></button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal" id="4Answer"></button>
                </div>
            </div>
        </div>
    </div>





    <script>
        var socket = io();
        //old question
        //        var question = "What is the population of Ireland?";
        //        var answer = ["4.7", "3.5", "6.2", "5.2"];
        socket.on("question table", function(questionTable) {
            console.log("Question table event received");
            console.log(questionTable);
            //           question = questionTable; 
            //           console.log(question);
        });
        var test;
        var correctAnswerId;

        d3.xml("/svg/irelandLow.svg").mimeType("image/svg+xml").get(function(error, xml) {
            if (error) throw error;
            document.body.appendChild(xml.documentElement);

            d3.select("g").attr("transform", "scale(0.7)");
            d3.select("svg").attr("width", 500);
            d3.select("svg").attr("height", 600);

            var svg = d3.select("body").select("svg");
            svg.selectAll("path").on("click", function() {

                //get the id of the selected/clicked path //
                var pathId = $(this).get(0).id;
                //toggleing the empty modal
                $('#myModal').modal('toggle');


                //getting a question from the database //
                //send an event to the database to make an sql query - more details in the app.js
                socket.emit("request random question");
                //getting the response from the server
                socket.on("random question", function(response) {
                    //populating the inputs and tags of the modal with the response from the server
                    console.log(response);

                    $("#exampleModalLabel").html("Question ID:" + response.question_id); //to be changed
                    $("#question").html(response.question);
                    $("#1Answer").html(response.answer); //id 1
                    $("#2Answer").html(response.answer); //id 2
                    $("#3Answer").html(response.answer); //id 3
                    $("#4Answer").html(response.answer); //id 4
                    //save the coorect answer //must be improved
                    correctAnswerId = response[0].correctAnsId; //can be injected by the user/hacker as it is set in the html not in the js file


                    console.log("i finished the socket and printed the question on the screen");


                    //check if the correct answer was clicked//

                    $('#' + correctAnswerId + 'Answer').click(function() {

                        //emit the event to the server with the path id so that the other players can see if the answer was right
                        socket.emit('right answer', pathId);

                        console.log("Right answer event emitted!");

                        //change the colour of the path.
                        $('#' + pathId).css("fill", "yellow");
                    });


                });









            });
            //known bug.. seems like the 
            //check if other users answered the question correctly
            socket.on('right answer', function(ter) {
                console.log("Right answer event received");

                //change the colour of the path
                $('#' + ter).css("fill", "yellow");
            });

        });

    </script>
